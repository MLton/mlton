\sec{Manual page}{manual-page}

{\mlton} is run from the command line with a collection of options followed by a
file name and a list of files to assemble and libraries to link with.
\begin{verbatim}
mlton [option ...] file.{cm|sml|c|o} [file.{S|o} ...] [library ...]
\end{verbatim}
The simplest case is to run {\tt mlton foo.sml}, where {\tt foo.sml} contains a
valid SML program, in which case {\mlton} compiles the program to produce an
executable called {\tt foo}.  {\mlton} has no notion of separate compilation.
The program must be the entire program you wish to compile; however, it may
refer to signatures and structures defined in the SML basis library.

For developing large programs spanning many files, {\mlton} supports a limited
subset of SML/NJ Compilation Manager (CM) files.  For example, {\tt mlton
foo.cm}, will compile the complete SML program consisting of the concatenatation
of all the SML files referred to (either directly or indirectly) by {\tt
foo.cm}.  See \secref{cm} for details.

\subsec{Compile-time options}{compile-time-options}

{\mlton}'s options allow you to control the name of the output file, the
verbosity of compile-time messages, and whether or not certain optimizations are
performed.  They also allow you to specify which intermediate files are saved
and to stop the compilation process early, at some intermediate pass.  {\mlton}
uses the input file suffix to determine the type of input program.  The
possibilities are {\tt .cm}, {\tt .sml}, {\tt .c}, {\tt .S} and {\tt .o}.

For a usage message, run {\mlton} with an invalid switch, e.g. {\tt mlton -z}.
In the explanation below and in the usage message, for flags that take a boolean
argument ({\tt {true|false}}), the first value listed is the default.  For
example, by default, overflow checking on is performed on integer arithmetic.

\newcommand{\option}[1]{\item[{\tt #1}]\hspace{1em}\\}

\begin{description}

\option{-detect-overflow \{true|false\}}
This flag controls whether or not overflow checking is performed on integer
arithmetic, in particular on {\tt Int.\{+,-,*,\~{},div,quot\}}.

% -D doesn't work right now
%
%\option{-D\mbox{\rm define}}
%Define a compile-time constant accessible via {\mlton}'s {\tt \_prim}
%syntax (see \secref{compile-time-constant}).

%If you compile {\tt -DMLton\_debug=1}, then the value of the variable
%{\tt MLton.debug} will be true.  The default is false.

\option{-exn-history \{false|true\}}
Enable {\tt Exn.history}.  See \secref{exn} for details.  This has a
performance impact, both in memory usage of exceptions and in runtime,
because of additional work that must be performed at each exception
construction, raise, and handle.

\option{-host \{self|...\}}
Generate an executable that runs on the specified host.  The default is {\tt
self}, which means to compile for the machine that {\mlton} is running on.  To
use any other host, you must first install a cross-compiler.  See
\secref{cross-compiling}.

\option{-ieee-fp \{false|true\}}
Control whether or not the native code generator is pedantic about following
the IEEE floating point standard.  By default, it is not, because of the
performance cost.  This has no effect with {\tt -native false}.

%\option{-include \mbox{\rm file.h}}
%Specify an additional {\tt .h} file to be included for defining compile-time
%constants (see \secref{compile-time-constant}).  The file will be included with
%{\tt \#include <file.h>}.

\option{-inline \mbox{\rm n}}
Set the inlining threshold used in the optimizer.  The default is 320.

%\option{-I\mbox{\rm dir}}
%Specify an additional directory to be searched for include files (included with
%{\tt -i}).

\option{-keep \{dot|g|o|sml|ssa\}}
Save the intermediate file(s) corresponding to the given arg.  If
no {\tt -keep} argument is given, then only the final file(s) is saved.\\
\begin{tabular}{ll}
{\tt dot} & dot files.  Implies {\tt -keep ssa}.  See \secref{profiling} for
details.\\
{\tt g} & generated {\tt .S} and {\tt .c} files passed to gcc and the assembler\\
{\tt o} & object files\\
{\tt sml} & SML file\\
{\tt ssa} & SSA file\\
\end{tabular}

\option{-l\mbox{\rm lib}}
Specify an additional library to link with.
This switch is passed unchanged to the linker.

\option{-L\mbox{\rm dir}}
Specify an additional directory to be searched for libraries.
This switch is passed unchanged to the linker.

\option{-native \{true|false\}}
Controls whether or not to use native code generation, as opposed to
generating C and using {\tt gcc}.  With native code generation,
{\mlton} typically compiles more quickly and generates better code.

\option{-o \mbox{\rm file}}
Specify the name of the final output file.
The default name is the input file name with its
suffix removed and an appropriate suffix added.

\option{-profile \{false|true\}}
Produce an executable that will gather profiling information.  {\tt -profile
true} implies {\tt -keep ssa}.  See \secref{profiling} for details.

\option{-safe \{true|false\}}
This switch determines the value of the SML variable {\tt MLton.safe}, which
controls whether the basis library performs array, string, and vector bounds
checks, division for zero checks, and other checks.  Compiling {\tt -safe false}
changes the behavior of some programs, does not conform to the basis library
specification, and may cause programs to seg fault.

\option{-show-basis-used \{false|true\}}
If true, then the compiler prints out the types, values, signatures, structures,
and functors from the basis library that the input program uses, and then exits.

\option{-static \{false|true\}}
If true, then produce a statically linked executable.  This option only
affects the linker.

\option{-stop \{f|g|o|sml\}}
Secify pass to stop at.\\
\begin{tabular}{ll}
{\tt f} & list of files on stdout (only makes sense when input is {\tt foo.cm})\\
{\tt g} & generated {\tt .S} and {\tt .c} files\\
{\tt sml} & SML file (only makes sense when input is {\tt foo.cm})\\
{\tt o} & object file\\
\end{tabular}\\
If you compile {\tt -stop g} or {\tt -stop o}, you can resume compilation by
running {\tt mlton} on the generated {\tt .c} and {\tt .S} or {\tt .o} files.

\option{-v[0123]}
How verbose to be about what passes are running.  The default is 0.\\
\begin{tabular}{ll}
{\tt 0} & silent\\
{\tt 1} & show calls to compiler, assembler, and linker\\
{\tt 2} & show all intermediate compiler passes\\
{\tt 3} & show all intermediate compiler passes, and some data structure sizes\\
\end{tabular}\\
With no other arguments, {\tt mlton -v} prints out the version number and the
default settings of all options and exits.

\end{description}

%\subsec{Compiler hacker options}{hacker-options}
%
%Some options are useful only to compiler hackers.  They can be seen by
%calling {\tt mlton -v -z}.  Some are documented here.
%
%\begin{description}
%
%\option{-}
%Add debugging information for gdb.  Link with a version of the runtime
%system that has asserts turned on (and runs about half as fast).
%The default is not to produce debugging information.
%
%\option{-indentation \mbox{\rm n}}
%Set the indentation level used when printing various ILs.
%
%\option{-show-types}
%Print types of bound variables when displaying ILs.
%
%\end{description}

\subsec{Runtime system options}{runtime-options}

To control the runtime system, executables produced by {\mlton} take
several optional command line arguments before their usual arguments.
To use these options, the first argument to the executable must be
``\verb+@MLton+''.  The optional arguments then follow, must be
terminated by ``\verb+--+'', and are followed by any arguments to the program.
The optional arguments are {\em not} made available to the SML
program via {\tt CommandLine.arguments}.  For example, a valid call
to {\tt hello-world} is: 
\begin{verbatim}
hello-world @MLton gc-summary fixed-heap 10k --
\end{verbatim}
In the above example, {\tt CommandLine.arguments () = []}.

\begin{description}
\option{fixed-heap \mbox{\rm n[}km\mbox{\rm ]}}
 Use a fixed size heap of {\tt n} bytes.
 A trailing {\tt k} means that {\tt n} is in units of 1024 bytes. 
 A trailing {\tt m} means that {\tt n} is in megabytes. 
 If neither appear, then {\tt n} is in bytes.
 A value of {\tt 0} means to use almost all the RAM present on the
 machine.

\option{gc-messages}
Print a message at the start and end of every garbage collection.

\option{gc-summary}
Print a summary of garbage collection statistics upon program
termination.

\option{load-world \mbox{\rm world}}
Restart the computation with the file specified by world.
The world file must have been created by a call to
{\tt MLton.World.save} by the same executable.  See \secref{world}
for details.

\option{max-heap \mbox{\rm n[}km\mbox{\rm ]}}
Run the computation with an automatically resized heap that is never
larger than n.  The meaning of [{\tt km}] is the same as with the
{\tt fixed-heap} option.

\option{ram-slop {\mbox{\rm x}}}
Multiply {\tt x} by the amount of RAM on the machine to obtain what
the runtime views as the amount of RAM it can use.
\end{description}
These options can also control the compiler, as in
\begin{verbatim}
mlton @MLton fixed-heap 100m -- foo.sml
\end{verbatim}
