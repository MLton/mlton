\sec{Manual page}{manual-page}{Manual_page.html}
%
{\mlton} is run from the command line with a collection of options
followed by a file name and a list of files to compile, assemble, and
link with.
\begin{verbatim}
mlton [option ...] file.{c|cm|mlb|o|sml} [file.{c|o|s|S} ...]
\end{verbatim}
The simplest case is to run {\tt mlton foo.sml}, where {\tt foo.sml}
contains a valid SML program, in which case {\mlton} compiles the
program to produce an executable {\tt foo}.  Since {\mlton} does not
support separate compilation, the program must be the entire
program you wish to compile.  However, the program may refer to
signatures and structures defined in the SML basis library.

Larger programs, spanning many files, may be compiled with the ML
Basis system (MLBs).  In this case, {\tt mlton foo.mlb} will compile
the complete SML program described by the basis {\tt foo.mlb}, which
may specify both SML files and additional bases.  See \secref{mlb} for
details.

{\mlton} also supports a limited subset of SML/NJ Compilation Manager
(CM) files.  For example, {\tt mlton foo.cm} will compile the complete
SML program consisting of the concatenation of all the SML files
referred to (either directly or indirectly) by {\tt foo.cm}.  See
\secref{cm} for details.
%
\subsec{Compile-time options}{compile-time-options}

{\mlton}'s options allow you to control the name of the output file,
the verbosity of compile-time messages, and whether or not certain
optimizations are performed.  They also allow you to specify which
intermediate files are saved and to stop the compilation process
early, at some intermediate pass, in which case compilation can be
resumed by passing the resulting files to {\mlton}.  {\mlton} uses the
input file suffix to determine the type of input program.  The
possibilities are {\tt .c}, {\tt .cm}, {\tt .o}, and {\tt .sml}.

With no arguments, {\mlton} prints the version number and exits.  For
a usage message, run {\mlton} with an invalid switch, e.g. {\tt mlton
-}.  In the explanation below and in the usage message, for flags
that take a boolean argument {\tt \{true|false\}}, the first value
listed is the default.  For example, by default, overflow checking on
is performed on integer arithmetic.

\newcommand{\option}[1]{\item[{\tt #1}]\hspace{1em}\\}
\newcommand{\choices}{{\it \{}}
\newcommand{\choice}{{\it |}}
\renewcommand{\choice}{|}
\newcommand{\choicesEnd}{{\it \}}}
\newcommand{\choiceTwo}[2]{\choices #1\choice #2\choicesEnd}
\newcommand{\choiceThree}[3]{\choices #1\choice #2\choice #3\choicesEnd}
\newcommand{\choiceFour}[4]{\choices #1\choice #2\choice #3\choice #4\choicesEnd}
\newcommand{\choiceSix}[6]
	   {\choices #1\choice #2\choice #3\choice #4\choice #5\choice
            #6\choicesEnd}
\newcommand{\falseTrue}{\choiceTwo{false}{true}}
\newcommand{\trueFalse}{\choiceTwo{true}{false}}

\begin{description}

\option{-align \choiceTwo{4}{8}}
Aligns object sizes and doubles in memory by the specified alignment.
On {\intel}, the default is {\tt 4} and on {\sparc} the default is
{\tt 8}.

\option{-cc-opt {\it option}}
Pass the option to {\tt gcc} when compiling C code.

\option{-codegen \choiceTwo{native}{c}}
Generate native code , as opposed to generating C and using {\tt gcc}.
With {\tt -codegen native}, {\mlton} typically compiles more quickly and
generates better code.

\option{-detect-overflow \trueFalse}
Perform overflow checking on integer arithmetic.

\option{-exn-history \falseTrue}
Enable {\tt Exn.history}.  See \secref{exn} for details.  There is a
performance cost to {\tt -exn-history true}, both in memory usage of
exceptions and in run time, because of additional work that must be
performed at each exception construction, raise, and handle.

\option{-export-header {\it file}}
Write to {\it file} C prototypes for all of the functions exported
from SML to C.  This flag is useful for programs that use {\export}
expressions (see \secref{export}).

\option{-ieee-fp \falseTrue}
Cause the native code generator to be pedantic about following the
IEEE floating point standard.  By default, it is not, because of the
performance cost.  This has no effect with {\tt -native false}.

\option{-inline {\it n}}
Set the inlining threshold used in the optimizer.  The threshold is an
approximate measure of code size of a procedure.  The default is 320.

\option{-keep \choiceThree{g}{o}{sml}}
Save intermediate files.  If no {\tt -keep} argument is given, then
only the output file is saved.\\
\hspace*{0.5in}
\begin{tabular}{l|l}
\hline
{\tt g} & generated {\tt .S} and {\tt .c} files passed to gcc and the assembler\\
{\tt o} & object ({\tt .o}) files\\
{\tt sml} & SML file\\
\end{tabular}

\option{-link-opt {\it opt}}
Pass the option to {\tt gcc} when linking.  You can use this to
specify library search paths, e.g. {\tt -link-opt -Lpath}, and
libraries to link with, e.g. {\tt -link-opt -lfoo}, or even both at
the same time, e.g. {\tt -link-opt '-Lpath -lfoo'}.  If you wish to
pash an option to the linker, you must use {\tt gcc}'s {\tt -Wl,}
syntax, e.g., {\tt -link-opt '-Wl,--export-dynamic'}.

\option{-output {\it file}}
Specify the name of the final output file. The default name is the
input file name with its suffix removed and an appropriate, possibly
empty, suffix added.

\option{-profile \choiceThree{no}{alloc}{count}{time}}
Produce an executable that will gather profiling information.  When
such an executable is run, it will produce an {\tt mlmon.out} file.
See \secref{profiling} for details.

\option{-profile-branch \falseTrue}
If true, the profiler will separately count the time spent (or bytes
allocated) in each branch of a function definition, {\tt case}
expression, and {\tt if} expression.

\option{-profile-stack \falseTrue}
If true, the profiler will count the time spent (or bytes allocated)
while a function is on the stack.

\option{-runtime {\it arg}}
Pass argument to the runtime system via {\tt @MLton}.  The argument
will be processed before other {\tt @MLton} command line switches.
Multiple uses of {\tt -runtime} are allowed, and will pass all the
arguments in order.  If the same runtime switch occurs more than once,
then the last setting will take effect.

\option{-safe \trueFalse}
This switch determines the value of the SML variable {\tt MLton.safe},
which controls whether the basis library performs array, string, and
vector bounds checks, division for zero checks, and other checks.
Compiling {\tt -safe false} changes the behavior of some programs,
does not conform to the basis library specification, and may cause
programs to seg fault.

\option{-show-basis {\it file}}
Pretty print to {\it file} the basis defined by the input program.

\option{-show-def-use {\it file}}
Output def-use information to {\it file}.  Each identifier that is
defined appears on a line, follwed on subequent lines by the position
of each use.

\option{-stop \choiceFour{f}{g}{o}{sml}}
Secify pass to stop at.\\
\hspace*{0.5in}
\begin{tabular}{l|l}
\hline
{\tt f} & list of files on stdout (only makes sense when input is {\tt foo.cm} or {\tt foo.mlb})\\
{\tt g} & generated {\tt .S} and {\tt .c} files\\
{\tt o} & object file\\
{\tt sml} & SML file (only makes sense when input is {\tt foo.cm} or {\tt foo.mlb})\\
{\tt tc} & after type checking\\
\end{tabular}\\
If you compile {\tt -stop g} or {\tt -stop o}, you can resume
compilation by running {\tt mlton} on the generated {\tt .c} and {\tt
.S} or {\tt .o} files. 

\option{-target \choiceTwo{self}{\ldots}}
Generate an executable that runs on the specified platform.  The default
is {\tt self}, which means to compile for the machine that {\mlton} is
running on.  To use any other target, you must first install a
cross-compiler.  See \secref{cross-compiling}.

\option{-verbose \choiceFour{0}{1}{2}{3}}
How verbose to be about what passes are running.  The default is 0.\\
\hspace*{0.5in}
\begin{tabular}{l|l}
\hline
{\tt 0} & silent\\
{\tt 1} & calls to compiler, assembler, and linker\\
{\tt 2} & 1 + intermediate compiler passes\\
{\tt 3} & 2 + some data structure sizes\\
\end{tabular}\\

\end{description}

\subsec{Runtime system options}{runtime-options}

To control the runtime system, executables produced by {\mlton} take
several optional command line arguments before their usual arguments.
To use these options, the first argument to the executable must be
\verb+@MLton+.  The optional arguments then follow, must be
terminated by \verb+--+, and are followed by any arguments to the
program.  The optional arguments are {\em not} made available to the
SML program via {\tt CommandLine.arguments}.  For example, a valid
call to {\tt hello-world} is:
\begin{verbatim}
hello-world @MLton gc-summary fixed-heap 10k -- a b c
\end{verbatim}
In the above example, {\tt CommandLine.arguments () = ["a", "b",
"c"]}.  It is also allowed to have a sequence of \verb+@MLton+
arguments, as in:
\begin{verbatim}
hello-world @MLton gc-summary -- @MLton fixed-heap 10k -- a b c
\end{verbatim}

Here are the allowed options.

\begin{description}
\option{fixed-heap {\it x}\choiceSix{k}{K}{m}{M}{g}{G}}
Use a fixed size heap of size {\it x}, where {\tt x} is a real number
and the trailing letter indicates its units.\\
\hspace*{0.5in}
\begin{tabular}{l|l}
\hline
{\tt k} or {\tt K} & 1024 \\
{\tt m} or {\tt M} & 1,048,576 \\
{\tt g} or {\tt G} & 1,073,741,824
\end{tabular}\\
A value of {\tt 0} means to use almost all the RAM present on the
machine.

\option{gc-messages}
Print a message at the start and end of every garbage collection.

\option{gc-summary}
Print a summary of garbage collection statistics upon program
termination.

\option{load-world \mbox{\rm world}}
Restart the computation with the file specified by world, which must
have been created by a call to {\tt MLton.World.save} by the same
executable.  See \secref{world} for details.

\option{max-heap {\it x}\choiceSix{k}{K}{m}{M}{g}{G}}
Run the computation with an automatically resized heap that is never
larger than {\it x}, where {\it x} is a real number and the trailing
letter indicates the units as with {\tt fixed-heap}.

\option{no-load-world}
Disable {\tt load-world}.  This can be used as an argument to the
compiler via {\tt -runtime no-load-world} to create executables that
will not load a world.  This may be useful to ensure that set-uid
executables do not load some strange world.

\option{ram-slop {\mbox{\rm x}}}
Multiply {\tt x} by the amount of RAM on the machine to obtain what
the runtime views as the amount of RAM it can use.  Typically {\tt x}
is less than 1, and is used to account for space used by other
programs running on the same machine.

\option{stop}
Causes the runtime to stop processing {\tt @MLton} arguments once the
next {\tt --} is reached.  This can be used as an argument to the
compiler via {\tt -runtime stop} to create executables that don't
process any {\tt @MLton} arguments.
\end{description}
These options can also control {\mlton}, as in
\begin{verbatim}
mlton @MLton fixed-heap 0.5g -- foo.sml
\end{verbatim}
